!function(){"use strict";class e{static#e=[{name:"loginUser",url:"//pinspire.online:8080/api/v1/auth/login"},{name:"logoutUser",url:"//pinspire.online:8080/api/v1/auth/logout"},{name:"registerUser",url:"//pinspire.online:8080/api/v1/auth/signup"}];static async loginUser(e,t){try{const r=this.#e.find((e=>"loginUser"===e.name));if(!r)throw new Error("Не найдена конфигурация для loginUser");const n=await fetch(r.url,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e,password:t}),credentials:"include"});return"ok"===(await n.json()).status}catch(e){throw console.error("Ошибка при выполнении запроса loginUser:",e),e}}static async checkLogin(){try{const e=this.#e.find((e=>"loginUser"===e.name));if(!e)throw new Error("Не найдена конфигурация для checkLogin");const t=await fetch(e.url,{credentials:"include"}),r=await t.json();let n=!1,o="";return"ok"===r.status&&(o=r.body.username,n=!0),{isAuthorized:n,username:o}}catch(e){console.error("Ошибка при получении данных об авторизации:",e)}}static async logoutUser(){try{const e=this.#e.find((e=>"logoutUser"===e.name));if(!e)throw new Error("Не найдена конфигурация для logoutUser");const t=await fetch(e.url,{method:"DELETE",credentials:"include"});return"ok"===(await t.json()).status}catch(e){console.error("Ошибка при выполнении запроса:",e)}}static async registerUser(e,t,r){try{const n=this.#e.find((e=>"registerUser"===e.name));if(!n)throw new Error("Не найдена конфигурация для registerUser");const o=await fetch(n.url,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e,email:t,password:r}),credentials:"include"});return"ok"===(await o.json()).status&&this.loginUser(e,r)}catch(e){console.error("Ошибка при выполнении запроса:",e)}}static async generatePins(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:20,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;try{const r=`//pinspire.online:8080/api/v1/pin?count=${e}&lastID=${t}`,n=await fetch(r),o=await n.json();let s,a=[];if("ok"===o.status)return a=o.body.pins,s=o.body.lastID,{images:a,lastID:s};throw new Error("Ошибка при получении данных из API")}catch(e){console.error("Ошибка при получении пинов:",e)}}}function t(e){let t={valid:!0,message:""};return e?/^[a-zA-Z0-9_-]+$/.test(e)&&/^[a-zA-Zа-яА-Я0-9!@#$%^&*()_+{}[]|:<>,.?~=-]+$/.test(e)?e.length<4?t={valid:!1,message:"Имя пользователя должно содержать не менее 4 символов"}:e.length>=50&&(t={valid:!1,message:"Имя пользователя должно содержать менее 50 символов"}):t={valid:!1,message:"Имя пользователя содержит недопустимые символы"}:t={valid:!1,message:"Заполните это поле"},t}function r(e){let t={valid:!0,message:""};return e?/^[a-zA-Zа-яА-Я0-9!@#$%^&*()_+{}[]|:<>,.?~=-]+$/.test(e)?e.length<8?t={valid:!1,message:"Пароль должен содержать не менее 8 символов"}:e.length>=50?t={valid:!1,message:"Пароль должен содержать менее 50 символов"}:/[a-z]/.test(e)?/[A-Z]/.test(e)||(t={valid:!1,message:"Пароль должен содержать хотя бы одну букву в верхнем регистре"}):t={valid:!1,message:"Пароль должен содержать хотя бы одну букву в нижнем регистре"}:t={valid:!1,message:"Пароль содержит недопустимые символы"}:t={valid:!1,message:"Заполните это поле"},t}function n(n,s){document.body.style.overflow="hidden";const a=Handlebars.templates["Reg.hbs"];s.innerHTML=a({});const l=s.querySelector("#password"),c=s.querySelector("#email"),d=s.querySelector("#username"),u=s.querySelector(".button"),m=s.querySelector(".cancel-button");s.querySelector(".already-registered a").addEventListener("click",(function(e){e.preventDefault(),o(n,s)}));const g=document.querySelector(".username-error-message"),v=document.querySelector(".email-error-message"),h=document.querySelector(".password-error-message"),y=document.querySelector(".wrong-data-error-message");u.addEventListener("click",(function(o){o.preventDefault();const a=document.getElementById("username").value,u=document.getElementById("email").value,m=document.getElementById("password").value;d.style.borderColor="",c.style.borderColor="",l.style.borderColor="";const f=t(a),p=function(e){let t={valid:!0,message:""};if(e)if(/^[a-zA-Zа-яА-Я0-9!@#$%^&*()_+{}[]|:<>,.?~=-]+$/.test(e))if(e.length>=50)t={valid:!1,message:"Email должен содержать не более 50 символов"};else if(e.includes("@")){const r=e.split("@");2!==r.length?t={valid:!1,message:"Email должен содержать только один символ @"}:r[1].split(".").length<2&&(t={valid:!1,message:"Некорректный формат домена в email"})}else t={valid:!1,message:"Email должен содержать символ @"};else t={valid:!1,message:"Email содержит недопустимые символы"};else t={valid:!1,message:"Заполните это поле"};return t}(u),w=r(m);f.valid?g.textContent="":(d.style.borderColor="var(--error-50, #F4210B)",d.style.color="var(--error-50, #F4210B)",g.textContent=f.message),p.valid?v.textContent="":(c.style.borderColor="var(--error-50, #F4210B)",c.style.color="var(--error-50, #F4210B)",v.textContent=p.message),w.valid?h.textContent="":(l.style.borderColor="var(--error-50, #F4210B)",l.style.color="var(--error-50, #F4210B)",h.textContent=w.message),f.valid&&p.valid&&w.valid&&e.registerUser(a,u,m).then((e=>{e?(n.classList.remove("header-hidden"),s.classList.remove("main-no-padding"),i()):(d.style.borderColor="var(--error-50, #F4210B)",c.style.borderColor="var(--error-50, #F4210B)",l.style.borderColor="var(--error-50, #F4210B)",y.textContent="Пользователь уже заригистрирован")}))})),m.addEventListener("click",(function(e){e.preventDefault(),n.classList.remove("header-hidden"),s.classList.remove("main-no-padding"),i()}))}function o(o,s){document.body.style.overflow="hidden";const a=Handlebars.templates["Auth.hbs"];s.innerHTML=a({});const l=s.querySelector("#password"),c=s.querySelector("#username"),d=s.querySelector(".button"),u=s.querySelector(".cancel-button");s.querySelector(".already-registered a").addEventListener("click",(function(e){e.preventDefault(),n(o,s)}));const m=document.querySelector(".username-error-message"),g=document.querySelector(".password-error-message"),v=document.querySelector(".wrong-data-error-message");d.addEventListener("click",(function(n){n.preventDefault();const a=document.getElementById("username").value,d=document.getElementById("password").value;c.style.borderColor="",l.style.borderColor="";const u=t(a),h=r(d);u.valid?m.textContent="":(c.style.borderColor="var(--error-50, #F4210B)",c.style.color="var(--error-50, #F4210B)",m.textContent=u.message),h.valid?g.textContent="":(l.style.borderColor="var(--error-50, #F4210B)",l.style.color="var(--error-50, #F4210B)",g.textContent=h.message),u.valid&&h.valid&&e.loginUser(a,d).then((e=>{e?(o.classList.remove("header-hidden"),s.classList.remove("main-no-padding"),i()):(c.style.borderColor="var(--error-50, #F4210B)",l.style.borderColor="var(--error-50, #F4210B)",v.textContent="Неверное имя пользователя или пароль")}))})),u.addEventListener("click",(function(e){e.preventDefault(),o.classList.remove("header-hidden"),s.classList.remove("main-no-padding"),i()}))}const s=100,a=20;let l=0;function i(){const t=document.getElementById("root");l=0,document.body.style.overflow="visible";const r=Handlebars.templates["Feed.hbs"],i=Handlebars.templates["Header.hbs"],c={isAuthorized:null,UserData:Handlebars.templates["UserData.hbs"],HeaderNonAuthorized:Handlebars.templates["HeaderNonAuthorized.hbs"],userDataContext:{username:null}};e.checkLogin().then((d=>{c.isAuthorized=d.isAuthorized,c.userDataContext.username=d.username;const u={Header:i,headerContext:c};t.innerHTML=r(u),function(){const t=document.getElementById("header"),r=document.getElementById("main"),i=document.querySelector(".js-header-btns__logout");i&&i.addEventListener("click",(n=>{n.preventDefault(),t.classList.add("header-hidden"),r.classList.add("main-no-padding"),e.logoutUser()&&(t.innerHTML="",window.removeEventListener("scroll",window.scrollFunc),o(t,r))}));const c=document.querySelector(".js-header-btns__login");c&&c.addEventListener("click",(e=>{e.preventDefault(),t.classList.add("header-hidden"),r.classList.add("main-no-padding"),t.innerHTML="",window.removeEventListener("scroll",window.scrollFunc),o(t,r)}));const d=document.querySelector(".js-header-btns__signup");d&&d.addEventListener("click",(e=>{e.preventDefault(),t.classList.add("header-hidden"),r.classList.add("main-no-padding"),t.innerHTML="",window.removeEventListener("scroll",window.scrollFunc),n(t,r)}));const u=document.querySelector(".header__nav-create__menu");if(u){const e=document.querySelector(".nav-create"),t=document.querySelector(".header__nav-create__menu-line1"),r=document.querySelector(".header__nav-create__menu-line2"),n=document.querySelector(".header__nav-create__menu-line3"),o=document.querySelector(".header__nav-create__btns");u.addEventListener("click",(()=>{e.classList.toggle("nav-open"),t.classList.toggle("line-cross"),r.classList.toggle("line-fade-out"),n.classList.toggle("line-cross"),o.classList.toggle("fade-in")}))}const m=document.querySelector(".js-header-user__data");if(m){const e=document.querySelector(".nav-user"),t=document.querySelector(".header__nav-user__btns");m.addEventListener("click",(r=>{e.contains(r.target)||(e.classList.toggle("nav-open"),t.classList.toggle("fade-in"))}))}const g=document.querySelector(".js-header-btns__profile");g&&g.addEventListener("click",(e=>{e.preventDefault(),window.removeEventListener("scroll",window.scrollFunc),function(e,t){const r=Handlebars.templates["Profile.hbs"];t.innerHTML=r({})}(0,r)}));const v=function(e,t){let r=!1;return function(){r||(e.apply(this,arguments),r=!0,setTimeout((()=>r=!1),t))}}((function(){const t=document.documentElement.scrollHeight,r=window.innerHeight;window.scrollY+r>=t-1e3&&e.generatePins(a,l).then((e=>{let{images:t,lastID:r}=e;l!=r?(r>s&&document.querySelectorAll(".gallery__item").forEach((e=>{const t=e.getAttribute("class").replace("gallery__item js-pin-id-","");t<r-s&&(e.remove(),console.log(`remove element ${t}}`))})),function(e,t){const r=Handlebars.templates["Pins.hbs"];t.forEach((t=>{const n={src:t.picture,id:t.id};e.insertAdjacentHTML("beforeend",r(n))}))}(document.getElementById("pins"),t),l=r):window.removeEventListener("scroll",window.scrollFunc)})).catch((e=>{console.error("Ошибка при рендеринге пинов:",e)}))}),100);window.scrollFunc=v,v(),window.addEventListener("scroll",window.scrollFunc)}()})).catch((e=>{console.error(e)}))}i()}();