(()=>{"use strict";class e{#e;#t;#n;#r;#s;#o;#i;constructor(){if(e.instance)return e.instance;e.instance=this,this.#e=null,this.#t=null,this.#n=null,this.#s=null,this.#o=null,this.#r=null,this.#i=[]}setCsrfToken(e){this.#e=e}getCsrfToken(){return this.#e}setCurrentPage(e){this.#t=e}getCurrentPage(){return this.#t}setIsAuthorized(e){this.#n=e}getIsAuthorized(){return this.#n}setUserID(e){this.#r=e}getUserID(){return this.#r}setUsername(e){this.#s=e}getUsername(){return this.#s}setAvatar(e){this.#o=e}getAvatar(){return this.#o}addPin(e){let{ID:t,setLike:n,countLikes:r}=e;return-1===this.#i.findIndex((e=>e.ID===t))&&(this.#i.push({ID:t,setLike:n,countLikes:r}),!0)}removePins(e){this.#i.splice(0,e)}deleteAllPins(){this.#i=[]}getSetLike(e){return this.#i.find((t=>t.ID===e))?.setLike}setLike(e,t){this.#i.find((t=>t.ID===e)).setLike=t}getCountLikes(e){return this.#i.find((t=>t.ID===e))?.countLikes}setCountLikes(e,t){this.#i.find((t=>t.ID===e)).countLikes=t}addLikePin(e){const t=this.#i.findIndex((t=>t.ID===e)),n=this.#i[t];return null===n.countLikes?null:(n.countLikes+=1,n.countLikes)}removeLikePin(e){const t=this.#i.findIndex((t=>t.ID===e)),n=this.#i[t];return null===n.countLikes?null:(n.countLikes-=1,n.countLikes)}}const t=e;class n{static state=new t;static#a=[{name:"loginUser",url:"//pinspire.online:8080/api/v1/auth/login"},{name:"logoutUser",url:"//pinspire.online:8080/api/v1/auth/logout"},{name:"registerUser",url:"//pinspire.online:8080/api/v1/auth/signup"},{name:"profileAvatar",url:"//pinspire.online:8080/api/v1/profile/avatar"},{name:"profileInfo",url:"//pinspire.online:8080/api/v1/profile/info"},{name:"profileEdit",url:"//pinspire.online:8080/api/v1/profile/edit"},{name:"profileEdit",url:"//pinspire.online:8080/api/v1/profile/edit"},{name:"csrfToken",url:"//pinspire.online:8080/api/v1/csrf"},{name:"getPinInfo",url:"//pinspire.online:8080/api/v1/pin"},{name:"createPin",url:"//pinspire.online:8080/api/v1/pin/create"},{name:"deletePin",url:"//pinspire.online:8080/api/v1/pin/delete"},{name:"addPins",url:"//pinspire.online:8080/api/v1/board/add/pins"},{name:"getUserPins",url:"//pinspire.online:8080/api/v1/feed/pin/personal?count=1000"},{name:"pinEdit",url:"//pinspire.online:8080/api/v1/pin/edit"},{name:"createBoard",url:"//pinspire.online:8080/api/v1/board/create"},{name:"getBoardInfo",url:"//pinspire.online:8080/api/v1/board/get"},{name:"deleteBoard",url:"//pinspire.online:8080/api/v1/board/delete"},{name:"getBoardPins",url:"//pinspire.online:8080/api/v1/feed/pin/personal?count=1000"},{name:"boardUpdate",url:"//pinspire.online:8080/api/v1/board/update"}];static async loginUser(e,t){try{const n=this.#a.find((e=>"loginUser"===e.name));if(!n)throw new Error("Не найдена конфигурация для loginUser");const r=await fetch(n.url,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":this.state.getCsrfToken()},body:JSON.stringify({username:e,password:t}),credentials:"include"}),s=r.headers.get("X-Set-CSRF-Token");return s&&this.state.setCsrfToken(s),"ok"===(await r.json()).status}catch(e){throw console.error("Ошибка при выполнении запроса loginUser:",e),e}}static async checkLogin(){try{const e=this.#a.find((e=>"loginUser"===e.name));if(!e)throw new Error("Не найдена конфигурация для checkLogin");const t=await fetch(e.url,{headers:{"X-CSRF-Token":this.state.getCsrfToken()},credentials:"include"}),n=t.headers.get("X-Set-CSRF-Token");n&&this.state.setCsrfToken(n);const r=await t.json();return"ok"===r.status?(this.state.setIsAuthorized(!0),this.state.setUserID(r.body.id),this.state.setUsername(r.body.username),this.state.setAvatar(r.body.avatar)):"csrf"===r.code?this.getCsrfToken().then((()=>{this.checkLogin()})):this.state.setIsAuthorized(!1),r.status}catch(e){console.error("Ошибка при получении данных об авторизации:",e)}}static async logoutUser(){try{const e=this.#a.find((e=>"logoutUser"===e.name));if(!e)throw new Error("Не найдена конфигурация для logoutUser");const t=await fetch(e.url,{method:"DELETE",headers:{"X-CSRF-Token":this.state.getCsrfToken()},credentials:"include"}),n=t.headers.get("X-Set-CSRF-Token");n&&this.state.setCsrfToken(n);const r=await t.json();return"ok"===r.status&&(this.state.setIsAuthorized(!1),this.state.setUserID(null),this.state.setUsername(null),this.state.setAvatar(null)),r.status}catch(e){console.error("Ошибка при выполнении запроса:",e)}}static async registerUser(e,t,n){try{const r=this.#a.find((e=>"registerUser"===e.name));if(!r)throw new Error("Не найдена конфигурация для registerUser");const s=await fetch(r.url,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":this.state.getCsrfToken()},body:JSON.stringify({username:e,email:t,password:n}),credentials:"include"}),o=s.headers.get("X-Set-CSRF-Token");return o&&this.state.setCsrfToken(o),"ok"===(await s.json()).status&&this.loginUser(e,n)}catch(e){console.error("Ошибка при выполнении запроса:",e)}}static async generatePins(e,t,n){try{let r;r=t===-1/0&&n===1/0?`//pinspire.online:8080/api/v1/feed/pin?count=${e}`:`//pinspire.online:8080/api/v1/feed/pin?count=${e}&maxID=${t}&minID=${n}`;const s=await fetch(r,{headers:{"X-CSRF-Token":this.state.getCsrfToken()},credentials:"include"}),o=s.headers.get("X-Set-CSRF-Token");o&&this.state.setCsrfToken(o);const i=await s.json();if("ok"===i.status)return i.body;throw new Error("Ошибка при получении данных из API")}catch(e){console.error("Ошибка при получении пинов:",e)}}static async getUserInfo(){try{const e=this.#a.find((e=>"profileInfo"===e.name));if(!e)throw new Error("Не найдена конфигурация для profileInfo");const t=await fetch(e.url,{headers:{"X-CSRF-Token":this.state.getCsrfToken()},credentials:"include"}),n=t.headers.get("X-Set-CSRF-Token");n&&this.state.setCsrfToken(n);const r=await t.json();if("ok"===r.status)return r.body;throw new Error("Ошибка при получении данных пользователя")}catch(e){console.error("Ошибка при получении данных об авторизации:",e)}}static async putUserInfo(e){let{username:t,name:n,surname:r,about_me:s,email:o,password:i}=e;try{const e=this.#a.find((e=>"profileEdit"===e.name));if(!e)throw new Error("Не найдена конфигурация для profileEdit");const a=await fetch(e.url,{method:"PUT",headers:{"Content-Type":"application/json","X-CSRF-Token":this.state.getCsrfToken()},body:JSON.stringify({username:t,name:n,surname:r,about_me:s,email:o,password:i}),credentials:"include"}),c=a.headers.get("X-Set-CSRF-Token");return c&&this.state.setCsrfToken(c),await a.json()}catch(e){throw console.error("Ошибка при обновлении данных пользователя:",e),e}}static async putUserAvatar(e,t){try{const n=this.#a.find((e=>"profileAvatar"===e.name));if(!n)throw new Error("Не найдена конфигурация для profileAvatar");const r=await fetch(n.url,{method:"PUT",headers:{"Content-Type":`image/${t}`,"X-CSRF-Token":this.state.getCsrfToken()},body:e,credentials:"include"}),s=r.headers.get("X-Set-CSRF-Token");return s&&this.state.setCsrfToken(s),await r.json()}catch(e){console.error("Ошибка при обновлении данных пользователя:",e)}}static async getCsrfToken(){try{const e=this.#a.find((e=>"csrfToken"===e.name));if(!e)throw new Error("Не найдена конфигурация для csrfToken");const t=(await fetch(e.url,{credentials:"include"})).headers.get("X-Set-CSRF-Token");console.log(t),t&&this.state.setCsrfToken(t)}catch(e){console.error("Ошибка при получении csrf токена",e)}}static async getLike(e){try{const t=`//pinspire.online:8080/api/v1/pin/like/isSet/${e}`,n=await fetch(t,{headers:{"X-CSRF-Token":this.state.getCsrfToken()},credentials:"include"}),r=n.headers.get("X-Set-CSRF-Token");r&&this.state.setCsrfToken(r);const s=await n.json();if("ok"===s.status)return s.body;throw new Error("Ошибка при получении данных о лайке")}catch(e){console.error("Ошибка:",e)}}static async setLike(e){try{const t=`//pinspire.online:8080/api/v1/pin/like/set/${e}`,n=await fetch(t,{method:"POST",headers:{"X-CSRF-Token":this.state.getCsrfToken()},credentials:"include"}),r=n.headers.get("X-Set-CSRF-Token");r&&this.state.setCsrfToken(r);const s=await n.json();if("ok"===s.status)return s.body;throw new Error("Ошибка при получении данных о лайке")}catch(e){console.error("Ошибка:",e)}}static async deleteLike(e){try{const t=`//pinspire.online:8080/api/v1/pin/like/${e}`,n=await fetch(t,{method:"DELETE",headers:{"X-CSRF-Token":this.state.getCsrfToken()},credentials:"include"}),r=n.headers.get("X-Set-CSRF-Token");r&&this.state.setCsrfToken(r);const s=await n.json();if("ok"===s.status)return s.body;throw new Error("Ошибка при получении данных о лайке")}catch(e){console.error("Ошибка:",e)}}static async getPinInfo(e){try{const t=this.#a.find((e=>"getPinInfo"===e.name));if(!t)throw new Error("Не найдена конфигурация для getPinInfo");const n=`${t.url}/${e}`,r=await fetch(n,{headers:{"X-CSRF-Token":this.state.getCsrfToken()},credentials:"include"}),s=r.headers.get("X-Set-CSRF-Token");s&&this.state.setCsrfToken(s);const o=await r.json();if("ok"===o.status)return o.body;throw new Error("Ошибка при получении данных о пине")}catch(e){throw console.error("Ошибка при получении данных о пине:",e),e}}static async createPin(e){try{const t=this.#a.find((e=>"createPin"===e.name));if(!t)throw new Error("Не найдена конфигурация для createPin");const n=await fetch(t.url,{method:"POST",headers:{"x-csrf-token":this.state.getCsrfToken()},body:e,credentials:"include"}),r=n.headers.get("X-Set-CSRF-Token");r&&this.state.setCsrfToken(r);const s=await n.json();return"ok"===s.status&&s}catch(e){throw console.error("Ошибка при выполнении запроса:",e),e}}static async deletePin(e){try{const t=`//pinspire.online:8080/api/v1/pin/delete/${e}`,n=await fetch(t,{method:"DELETE",headers:{"x-csrf-token":this.state.getCsrfToken()},credentials:"include"}),r=n.headers.get("X-Set-CSRF-Token");r&&this.state.setCsrfToken(r);const s=await n.json();if("ok"===s.status)return s.body;throw new Error("Ошибка при получении данных об удалении пина")}catch(e){console.error("Ошибка:",e)}}static async addBoardPins(e,t){try{const n=`//pinspire.online:8080/api/v1/board/add/pins/${e}`,r=await fetch(n,{method:"POST",headers:{"x-csrf-token":this.state.getCsrfToken()},body:JSON.stringify({pins:t}),credentials:"include"}),s=r.headers.get("X-Set-CSRF-Token");s&&this.state.setCsrfToken(s);const o=await r.json();if("ok"===o.status)return o.body;throw new Error("Ошибка при получении данных о доске")}catch(e){console.error("Ошибка:",e)}}static async putPinInfo(e,t,n){try{const r=`//pinspire.online:8080/api/v1/pin/edit/${e}`,s=await fetch(r,{method:"PUT",headers:{"Content-Type":"application/json","x-csrf-token":this.state.getCsrfToken()},body:JSON.stringify({title:t,description:n}),credentials:"include"}),o=s.headers.get("X-Set-CSRF-Token");return o&&this.state.setCsrfToken(o),await s.json()}catch(e){throw console.error("Ошибка при обновлении данных пина:",e),e}}static async createBoard(e,t){try{const n=this.#a.find((e=>"createBoard"===e.name));if(!n)throw new Error("Не найдена конфигурация для createBoard");const r=await fetch(n.url,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":this.state.getCsrfToken()},body:JSON.stringify({title:e,description:t,public:!0,tags:[" "]}),credentials:"include"}),s=r.headers.get("X-Set-CSRF-Token");s&&this.state.setCsrfToken(s);const o=await r.json();if("ok"===o.status&&o.body&&o.body.new_board_id)return{status:"ok",body:{new_board_id:o.body.new_board_id}};throw new Error("Ошибка при получении данных из API")}catch(e){throw console.error("Ошибка при выполнении запроса:",e),e}}static async getMyPins(){try{const e=`//pinspire.online:8080/api/v1/feed/pin?count=1000&userID=${this.state.getUserID()}`,t=await fetch(e,{headers:{"X-CSRF-Token":this.state.getCsrfToken()},credentials:"include"}),n=t.headers.get("X-Set-CSRF-Token");n&&this.state.setCsrfToken(n);const r=await t.json();if("ok"===r.status)return r.body;throw new Error("Ошибка при получении данных из API")}catch(e){console.error("Ошибка при получении пинов:",e)}}static async getMyBoards(){try{const e=`//pinspire.online:8080/api/v1/board/get/user/${this.state.getUsername()}`,t=await fetch(e,{headers:{"X-CSRF-Token":this.state.getCsrfToken()},credentials:"include"}),n=t.headers.get("X-Set-CSRF-Token");n&&this.state.setCsrfToken(n);const r=await t.json();if("ok"===r.status)return r.body;throw new Error("Ошибка при получении данных из API")}catch(e){console.error("Ошибка при получении досок:",e)}}static async getUserPins(e){try{const t=`//pinspire.online:8080/api/v1/feed/pin?count=1000&userID=${e}`,n=await fetch(t,{headers:{"X-CSRF-Token":this.state.getCsrfToken()},credentials:"include"}),r=n.headers.get("X-Set-CSRF-Token");r&&this.state.setCsrfToken(r);const s=await n.json();if("ok"===s.status)return s.body;throw new Error("Ошибка при получении данных из API")}catch(e){console.error("Ошибка при получении пинов:",e)}}static async getLikedPins(){try{const e=`//pinspire.online:8080/api/v1/feed/pin?count=1000&userID=${this.state.getUserID()}&liked=true`,t=await fetch(e,{headers:{"X-CSRF-Token":this.state.getCsrfToken()},credentials:"include"}),n=t.headers.get("X-Set-CSRF-Token");n&&this.state.setCsrfToken(n);const r=await t.json();if("ok"===r.status)return r.body;throw new Error("Ошибка при получении данных из API")}catch(e){console.error("Ошибка при получении лайкнутых пинов:",e)}}static async getUserBoards(e){try{const t=`//pinspire.online:8080/api/v1/board/get/user/${e}`,n=await fetch(t,{headers:{"X-CSRF-Token":this.state.getCsrfToken()},credentials:"include"}),r=n.headers.get("X-Set-CSRF-Token");r&&this.state.setCsrfToken(r);const s=await n.json();if("ok"===s.status)return s.body;throw new Error("Ошибка при получении данных из API")}catch(e){console.error("Ошибка при получении досок:",e)}}static async getBoardInfo(e){try{const t=this.#a.find((e=>"getBoardInfo"===e.name));if(!t)throw new Error("Не найдена конфигурация для getBoardInfo");const n=`${t.url}/${e}`,r=await fetch(n,{headers:{"X-CSRF-Token":this.state.getCsrfToken()},credentials:"include"}),s=r.headers.get("X-Set-CSRF-Token");s&&this.state.setCsrfToken(s);const o=await r.json();if("ok"===o.status)return o.body;throw new Error("Ошибка при получении данных о доске")}catch(e){throw console.error("Ошибка при получении данных о доске:",e),e}}static async deleteBoard(e){try{const t=`//pinspire.online:8080/api/v1/board/delete/${e}`,n=await fetch(t,{method:"DELETE",headers:{"x-csrf-token":this.state.getCsrfToken()},credentials:"include"}),r=n.headers.get("X-Set-CSRF-Token");r&&this.state.setCsrfToken(r);const s=await n.json();if("ok"===s.status)return s.body;throw new Error("Ошибка при получении данных об удалении доски")}catch(e){console.error("Ошибка:",e)}}static async getBoardPins(e){try{const t=`//pinspire.online:8080/api/v1/feed/pin?count=1000&boardID=${e}`,n=await fetch(t,{headers:{"X-CSRF-Token":this.state.getCsrfToken()},credentials:"include"}),r=n.headers.get("X-Set-CSRF-Token");r&&this.state.setCsrfToken(r);const s=await n.json();if("ok"===s.status)return s.body;throw new Error("Ошибка при получении данных из API")}catch(e){console.error("Ошибка при получении пинов:",e)}}static async putBoardInfo(e,t,n,r){try{const s=`//pinspire.online:8080/api/v1/board/update/${e}`,o=await fetch(s,{method:"PUT",headers:{"Content-Type":"application/json","x-csrf-token":this.state.getCsrfToken()},body:JSON.stringify({title:t,description:n,pins:r,public:!1}),credentials:"include"}),i=o.headers.get("X-Set-CSRF-Token");return i&&this.state.setCsrfToken(i),await o.json()}catch(e){throw console.error("Ошибка при обновлении данных доски:",e),e}}static async getUserSubscriptions(){try{const e="//pinspire.online:8083/api/v1/subscription/user/get?&view=subscriptions",t=await fetch(e,{headers:{"X-CSRF-Token":this.state.getCsrfToken()},credentials:"include"}),n=t.headers.get("X-Set-CSRF-Token");n&&this.state.setCsrfToken(n);const r=await t.json();if("ok"===r.status)return r.body;throw new Error("Ошибка при получении данных из API")}catch(e){console.error("Ошибка при получении подписок:",e)}}static async getSomeUserInfo(e){try{const t=`//pinspire.online:8083/api/v1/user/info/${e}`,n=await fetch(t,{headers:{"X-CSRF-Token":this.state.getCsrfToken()},credentials:"include"}),r=n.headers.get("X-Set-CSRF-Token");r&&this.state.setCsrfToken(r);const s=await n.json();if("ok"===s.status)return s.body;throw new Error("Ошибка при получении данных из API")}catch(e){console.error("Ошибка при получении данных пользователя:",e)}}static async subscribeToUser(e){try{const t="//pinspire.online:8083/api/v1/subscription/user/create",n=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":this.state.getCsrfToken()},body:JSON.stringify({to:+e}),credentials:"include"}),r=n.headers.get("X-Set-CSRF-Token");r&&this.state.setCsrfToken(r);const s=await n.json();return"ok"===s.status?s.body:(s.message,s.code)}catch(e){console.error("Ошибка при получении данных пользователя:",e)}}static async unsubscribeFromUser(e){try{const t="//pinspire.online:8083/api/v1/subscription/user/delete",n=await fetch(t,{method:"DELETE",headers:{"Content-Type":"application/json","X-CSRF-Token":this.state.getCsrfToken()},body:JSON.stringify({to:+e}),credentials:"include"}),r=n.headers.get("X-Set-CSRF-Token");r&&this.state.setCsrfToken(r);const s=await n.json();return"ok"===s.status?s.body:(s.message,s.code)}catch(e){console.error("Ошибка при получении данных пользователя:",e)}}}function r(){const t=new e;if(!t.getIsAuthorized)return;const n=new L,r=document.querySelector("#sidebar"),s=Handlebars.templates["Sidebar.hbs"];r.innerHTML=s();const o=document.querySelector(".sidebar__menu__profile__arrow");o?.addEventListener("click",(()=>{const e=document.querySelector(".js-sidebar__menu__profile-fields"),t=document.querySelector(".sidebar__menu__profile__arrow-img");e.classList.contains("hide")?t.src="/assets/icons/actions/icon_profile_arrow-up.svg":t.src="/assets/icons/actions/icon_profile_arrow-down.svg",e.classList.toggle("hide")})),document.querySelectorAll(".sidebar__menu__btn").forEach((e=>{e?.addEventListener("click",(t=>{const r=document.querySelector(".sidebar__menu__profile__arrow-img");if(t.target!=r)switch(e.className.split(" ")[1].split("__")[2]){case"feed":n.navigate("/");break;case"messenger":n.navigate("/messenger");break;case"subscriptions":n.navigate("/subscriptions");break;case"favourite":n.navigate("/favourite");break;case"profile":n.navigate("/profile");break;case"profile-data":n.navigate("/profile/data");break;case"profile-security":n.navigate("/profile/security")}}))}));const i=document.querySelector(".js-sidebar__logo-img");i?.addEventListener("click",(function(e){e.preventDefault(),"feed"===t.getCurrentPage()?window.scrollTo({top:0,behavior:"smooth"}):n.navigate("/")}))}function s(){const e=document.querySelector("#header"),r=new L,s=new t,o=Handlebars.templates["HeaderDefault.hbs"],i={username:s.getUsername(),avatar:s.getAvatar()};e.innerHTML=o(i);const a=document.querySelector(".header__create__menu");document.querySelectorAll(".header__create__menu__item").forEach((e=>{e?.addEventListener("click",(()=>{switch(e.className.split(" ")[0].split("__")[3]){case"pin":r.navigate("/create/pin");break;case"board":r.navigate("/create/board")}}))}));const c=document.querySelector(".js-create-img");c?.addEventListener("click",(()=>{a.classList.toggle("hide")}));const l=document.querySelector(".header__notifications__menu"),d=document.querySelector(".js-notification-img");d?.addEventListener("click",(()=>{l.classList.contains("hide")?d.src="/assets/icons/forHeader/notification-active.svg":d.src="/assets/icons/forHeader/notification.svg",l.classList.toggle("hide")}));const u=document.querySelector(".header__user__menu");document.querySelectorAll(".header__user__menu__item").forEach((e=>{e?.addEventListener("click",(()=>{switch(e.className.split(" ")[0].split("__")[3]){case"profile":r.navigate("/profile");break;case"logout":n.logoutUser().then((e=>{"ok"===e?r.navigate("/login"):console.log("error logout")})).catch((e=>{console.error(e)}))}}))}));const h=document.querySelector(".header__user__avatar-img");h?.addEventListener("click",(()=>{u.classList.contains("hide")?m.src="/assets/icons/actions/icon_profile_arrow-up.svg":m.src="/assets/icons/actions/icon_profile_arrow-down.svg",u.classList.toggle("hide")}));const m=document.querySelector(".header__user__avatar-user-arrow");document.body.addEventListener("click",(e=>{e.target!==c&&a.classList.add("hide"),e.target!==d&&(l.classList.add("hide"),d.src="/assets/icons/forHeader/notification.svg"),e.target!==document.querySelector(".header__user__avatar-user")&&e.target!==document.querySelector(".header__user__avatar-user-arrow")&&(u.classList.add("hide"),m.src="/assets/icons/actions/icon_profile_arrow-down.svg")}));const p=document.querySelector(".header__filter__img-image"),g=document.querySelector(".header__filter__list");p?.addEventListener("click",(()=>{g.classList.toggle("hide")}))}function o(e,t){const n=Handlebars.templates["Pins.hbs"];t.forEach((t=>{const r={src:t.picture,id:t.id};e?.insertAdjacentHTML("beforeend",n(r))}))}function i(){const e=new t,r=new L,s=document.querySelectorAll(".gallery__item");e.getIsAuthorized()?s.forEach((t=>{const s={ID:t.className.split(" ")[1].split("-")[3],setLike:null,countLikes:null},o=document.querySelector(`.like-counter-${s.ID}`),i=document.querySelector(`.js-like-button-${s.ID}`);e.addPin(s)&&(t.addEventListener("click",(t=>{t.target.classList.contains("like-icon")||(e.deleteAllPins(),r.navigate(`/pin/${s.ID}`))})),t.addEventListener("mouseenter",(()=>{const t=e.getSetLike(s.ID);null!==t?!0===t?i.src="/assets/icons/like_active.svg":!1===t&&(i.src="/assets/icons/like.svg"):n.getLike(s.ID).then((t=>{e.setLike(s.ID,t.is_set),t.is_set?i.src="/assets/icons/like_active.svg":i.src="/assets/icons/like.svg"})).catch((e=>{console.error(e)}));const r=e.getCountLikes(s.ID);null!==r&&(o.innerHTML=r,o.style.opacity=1)})),t.addEventListener("mouseleave",(()=>{o.style.opacity=0})),i.addEventListener("click",(()=>{const t=e.getSetLike(s.ID);if(null!==t)if(!0===t){i.src="/assets/icons/like.svg";const t=e.removeLikePin(s.ID);null!==t&&(o.innerHTML=t,o.style.opacity=1),n.deleteLike(s.ID).then((t=>{e.setLike(s.ID,!1),null===e.getCountLikes(s.ID)?(e.setCountLikes(s.ID,t.count_like),o.innerHTML=e.getCountLikes(s.ID),o.style.opacity=1):e.setCountLikes(s.ID,t.count_like)})).catch((e=>{console.error(e)}))}else{i.src="/assets/icons/like_active.svg";const t=e.addLikePin(s.ID);null!==t&&(o.innerHTML=t,o.style.opacity=1),n.setLike(s.ID).then((n=>{e.setLike(s.ID,!0),null===t?(e.setCountLikes(s.ID,n.count_like),o.innerHTML=e.getCountLikes(s.ID),o.style.opacity=1):e.setCountLikes(s.ID,n.count_like)})).catch((e=>{console.error(e)}))}})))})):s.forEach((t=>{const n={ID:t.className.split(" ")[1].split("-")[3],setLike:null,countLikes:null},s=document.querySelector(`.js-like-button-${n.ID}`);e.addPin(n)&&(t.addEventListener("click",(t=>{t.target.classList.contains("like-icon")||(e.deleteAllPins(),r.navigate(`/pin/${n.ID}`))})),s.addEventListener("click",(()=>{e.deleteAllPins(),r.navigate("/login")})))}))}function a(){const e=new t,n=new L,r=document.querySelector("#header"),s=Handlebars.templates["HeaderGuest.hbs"];r.innerHTML=s({});const o=document.querySelector(".js-header__login-btn");o?.addEventListener("click",(()=>{n.navigate("/login")}));const i=document.querySelector(".js-header__singup-btn");i?.addEventListener("click",(()=>{n.navigate("/signup")}));const a=document.querySelector(".js-header-guest__logo-img");a?.addEventListener("click",(function(t){t.preventDefault(),"feed"===e.getCurrentPage()?window.scrollTo({top:0,behavior:"smooth"}):n.navigate("/")}))}function c(e,t){const n=Handlebars.templates["UserBoards.hbs"];t.forEach((t=>{const r=Array.from(t.pins).slice(0,3),s={id:t.board_id,title:t.title,pins:r};e?.insertAdjacentHTML("beforeend",n(s))}))}function l(e,t,n,r){const s=new L,o=Handlebars.templates["NonContentNotification.hbs"],i={textContent:t,btnContent:n};e.innerHTML=o(i),document.querySelector(".js-non-content-goto-btn").addEventListener("click",(()=>{e.innerHTML="",s.navigate(r)}))}function d(){const e=new L,t=document.querySelectorAll(".user__board");t?.forEach((t=>{t.addEventListener("click",(n=>{const r=t.className.split(" ")[1].split("-")[3];e.navigate(`/board/${r}`)}))}))}function u(){n.getMyPins().then((e=>{const t=document.querySelector(".user-non-content"),n=document.querySelector(".user-pins-gallery");document.querySelector(".user-boards-gallery").innerHTML="",t.innerHTML="",e.pins?(o(n,e.pins),i()):l(t,"У вас пока нет пинов","Создать пин","/create/pin")})).catch((e=>{console.error("Ошибка при рендеринге пинов:",e)}))}function h(e){let t={valid:!0,message:""};return e?/^[a-zA-Z0-9_-]+$/.test(e)&&/^[a-zA-Zа-яА-Я0-9!@#$%^&*()_+{}[]|:<>,.?~=-]+$/.test(e)?e.length<4?t={valid:!1,message:"Имя пользователя должно содержать более 4 символов"}:e.length>=50&&(t={valid:!1,message:"Имя пользователя должно содержать менее 50 символов"}):t={valid:!1,message:"Имя пользователя содержит недопустимые символы"}:t={valid:!1,message:"Заполните это поле"},t}function m(e){let t={valid:!0,message:""};if(e)if(/^[a-zA-Zа-яА-Я0-9!@#$%^&*()_+{}[]|:<>,.?~=-]+$/.test(e))if(e.length>=50)t={valid:!1,message:"Email должен содержать не более 50 символов"};else if(e.includes("@")){const n=e.split("@");2!==n.length?t={valid:!1,message:"Email должен содержать только один символ @"}:n[1].split(".").length<2&&(t={valid:!1,message:"Некорректный формат домена в email"})}else t={valid:!1,message:"Email должен содержать символ @"};else t={valid:!1,message:"Email содержит недопустимые символы"};else t={valid:!1,message:"Заполните это поле"};return t}function p(e){let t={valid:!0,message:""};return e?/^[a-zA-Zа-яА-Я0-9!@#$%^&*()_+{}[]|:<>,.?~=-]+$/.test(e)?e.length<8?t={valid:!1,message:"Пароль должен содержать не менее 8 символов"}:e.length>=50?t={valid:!1,message:"Пароль должен содержать менее 50 символов"}:/[a-z]/.test(e)?/[A-Z]/.test(e)||(t={valid:!1,message:"Пароль должен содержать символ в верхнем регистре"}):t={valid:!1,message:"Пароль должен содержать символ в нижнем регистре"}:t={valid:!1,message:"Пароль содержит недопустимые символы"}:t={valid:!1,message:"Заполните это поле"},t}function g(t){const r=new L,s=(new e,document.querySelector("#main")),o=Number(t);let i=-1/0,a=1/0,c=!1;const l=[],d=Handlebars.templates["AddPins.hbs"];s.innerHTML=d({});const u=function(e,t){let n=!1;return function(){n||(e.apply(this,arguments),n=!0,setTimeout((()=>n=!1),250))}}((function(){if(!c){const e=document.documentElement.scrollHeight,t=window.innerHeight;window.scrollY+t>=e-1e3&&n.generatePins(12,i,a).then((e=>{i=Math.max(i,e.maxID),a=Math.min(a,e.minID),function(e,t){const n=Handlebars.templates["PinOnBoard.hbs"];t.forEach((t=>{const r={src:t.picture,id:t.id};e?.insertAdjacentHTML("beforeend",n(r))}))}(document.getElementById("add_pins"),e.pins),function(){const e=document.querySelectorAll(".int__gallery__item");e?.forEach((e=>{e.addEventListener("click",(t=>{const n=Number(e.className.split(" ")[1].split("-")[3]);if(e.classList.toggle("selected"),!isNaN(n)){const t=l.indexOf(n);-1===t?(l.push(n),e.classList.add("selected")):(l.splice(t,1),e.classList.remove("selected")),console.log(l)}}))}))}(),c=!0})).catch((e=>{console.error("Ошибка при рендеринге пинов:",e)}))}}));window.scrollFunc=u,u(),window.removeEventListener("scroll",window.scrollFunc),window.addEventListener("scroll",window.scrollFunc);const h=document.querySelector(".pin-back-button"),m=document.querySelector(".pin-add-button");h.addEventListener("click",(function(e){e.preventDefault(),r.navigate("/create/board")})),m.addEventListener("click",(function(e){console.log(t,l),n.addBoardPins(o,l),r.navigate("/"),e.preventDefault()}))}function f(e){const t=document.querySelector(".header__search"),n=document.querySelector(".header__left"),r=document.querySelector(".header__title");r.innerHTML=e,t.classList.add("hide"),n.classList.remove("hide"),r.classList.remove("hide")}function y(e){if(!e)return;const t=document.querySelector(".sidebar__menu__btn-active");t?.classList.remove("sidebar__menu__btn-active");const n=t.className.split(" ")[1].split("__")[2],r=document.querySelector(`.sidebar__menu__${n}__icon-img`);r.src=r.getAttribute("src").substring(0,r.getAttribute("src").length-11)+r.getAttribute("src").substring(r.getAttribute("src").length-4);const s=document.querySelector(`.sidebar__menu__${e}__icon-img`);s.src=s.getAttribute("src").substring(0,s.getAttribute("src").length-4)+"-active"+s.getAttribute("src").substring(s.getAttribute("src").length-4);const o=document.querySelector(`.sidebar__menu__${e}`);if(o?.classList.add("sidebar__menu__btn-active"),["profile","profile-data","profile-security"].includes(e)){const e=document.querySelector(".js-sidebar__menu__profile-fields"),t=document.querySelector(".sidebar__menu__profile__arrow-img");e.classList.remove("hide"),t.src="/assets/icons/actions/icon_profile_arrow-up.svg"}}function v(e){n.getUserPins(e).then((e=>{const t=document.querySelector(".user-non-content"),n=document.querySelector(".user-pins-gallery");document.querySelector(".user-boards-gallery").innerHTML="",t.innerHTML="",e.pins?(o(n,e.pins),i()):t.innerHTML="У этого пользователя нет пинов"})).catch((e=>{console.error("Ошибка при рендеринге пинов:",e)}))}function b(){window.scrollTo({top:0})}class L{#c;#l;#d;#u;constructor(){if(L.instance)return L.instance;L.instance=this,this.state=new t,this.#c=[{path:"/",handler:()=>{"feed"!==this.state.getCurrentPage()&&(window.removeEventListener("scroll",window.scrollFunc),this.state.deleteAllPins(),this.state.setCurrentPage("feed"),this.state.getIsAuthorized()?(""===document.querySelector("#sidebar").innerHTML&&r(),y("feed"),""===document.querySelector("#header").innerHTML&&s(),function(){const e=document.querySelector(".header__search"),t=document.querySelector(".header__left"),n=document.querySelector(".header__title");n.innerHTML="",e.classList.remove("hide"),t.classList.add("hide"),n.classList.add("hide")}()):a(),function(){const t=new e,r=document.querySelector("#main");let s=-1/0,a=1/0;const c=Handlebars.templates["Feed.hbs"],l=Handlebars.templates["Intro.hbs"],d={isAuthorized:!t.getIsAuthorized(),Intro:l};r.innerHTML=c(d);const u=function(e,t){let n=!1;return function(){n||(e.apply(this,arguments),n=!0,setTimeout((()=>n=!1),250))}}((function(){const e=document.documentElement.scrollHeight,r=window.innerHeight;window.scrollY+r>=e-1e3&&n.generatePins(20,s,a).then((e=>{if(e.maxID===s&&e.minID===a)return void window.removeEventListener("scroll",window.scrollFunc);s=Math.max(s,e.maxID),a=Math.min(a,e.minID),o(document.getElementById("pins"),e.pins),i();const n=document.querySelectorAll(".gallery__item");if(n?.length>100){const e=Array.from(n).slice(0,20);t.removePins(20),e.forEach((e=>{e.remove()}))}})).catch((e=>{console.error("Ошибка при рендеринге пинов:",e)}))}));window.scrollFunc=u,u(),window.removeEventListener("scroll",window.scrollFunc),window.addEventListener("scroll",window.scrollFunc)}())}},{path:"/profile",handler:()=>{"profile"!==this.state.getCurrentPage()&&(this.state.getIsAuthorized()?(this.state.deleteAllPins(),this.state.setCurrentPage("profile"),""===document.querySelector("#sidebar").innerHTML&&r(),y("profile"),""===document.querySelector("#header").innerHTML&&s(),f("Мои пины и доски"),function(){const e=document.querySelector("#main"),r=new t,s=Handlebars.templates["ProfileUser.hbs"],o={avatar:r.getAvatar(),username:r.getUsername()};e.innerHTML=s(o);const i=document.querySelector(".profile-user__pins-btn");i?.addEventListener("click",(()=>{const e=document.querySelector(".profile-user__btn-active");e!==i&&(e.classList.remove("profile-user__btn-active"),i.classList.add("profile-user__btn-active"),u())}));const a=document.querySelector(".profile-user__boards-btn");a?.addEventListener("click",(()=>{const e=document.querySelector(".profile-user__btn-active");e!==a&&(e.classList.remove("profile-user__btn-active"),a.classList.add("profile-user__btn-active"),n.getMyBoards().then((e=>{const t=document.querySelector(".user-non-content"),n=document.querySelector(".user-pins-gallery"),r=document.querySelector(".user-boards-gallery");n.innerHTML="",t.innerHTML="",e.length?(c(r,e),d()):l(t,"У вас пока нет досок","Создать доску","/create/board")})).catch((e=>{console.error("Ошибка при рендеринге досок:",e)})))})),u()}()):this.navigate("/login"))}},{path:"/profile/data",handler:()=>{this.state.getIsAuthorized()?(this.state.deleteAllPins(),this.state.setCurrentPage("profileData"),""===document.querySelector("#sidebar").innerHTML&&r(),y("profile-data"),""===document.querySelector("#header").innerHTML&&s(),f("Данные аккаунта"),function(){const e=document.querySelector("#main"),t=new L;n.getUserInfo().then((r=>{const s=Handlebars.templates["ProfileData.hbs"],o={username:r.username,name:r.name,surname:r.surname,avatar:r.avatar,about:r.about_me};e.innerHTML=s(o);const i=document.querySelector(".profile-data__avatar-span"),a=document.querySelector(".profile-data__username-span"),c=document.querySelector(".profile-data-span"),l=document.getElementById("input__file");l?.addEventListener("change",(e=>{const r=e.target.files[0],s=new FileReader;s.onload=e=>{const s=e.target.result,o=new Blob([s]),a=r.name.split(".").pop();["png","jpeg","svg","webp"].includes(a)?n.putUserAvatar(o,a).then((e=>{"ok"===e.status?t.navigate("/profile/data"):"error"===e.status&&"failed to change user's avatar"===e.message?i.textContent="Эта аватарка не подойдет":console.error("error saving avatar")})).catch((e=>{console.error(e)})):i.textContent="Эта аватарка не подойдет"},s.readAsArrayBuffer(r)}));const d=document.querySelector(".profile-data__avatar"),u=document.querySelector(".profile-data__edit-avatar");d?.addEventListener("mouseenter",(()=>{u.classList.remove("hide")})),d?.addEventListener("mouseleave",(()=>{u.classList.add("hide")})),u?.addEventListener("click",(()=>{l.click()}));const m=document.querySelector(".js-profile-data__data-names__username-data"),p=document.querySelector(".js-profile-data__data-names__name-data"),g=document.querySelector(".js-profile-data__data-names__surname-data"),f=document.querySelector(".js-profile-data__data-about__data"),y=document.querySelector(".js-username-textarea"),v=document.querySelector(".js-name-textarea"),b=document.querySelector(".js-surname-textarea"),L=document.querySelector(".js-about-textarea"),_=document.querySelector(".profile-data__edit-data");_?.addEventListener("click",(()=>{_.classList.add("hide"),document.querySelector(".js-profile-data").classList.add("profile-data-edit"),document.querySelector(".profile-data__control").classList.remove("hide"),m.classList.add("input-primary"),p.classList.add("input-primary"),g.classList.add("input-primary"),f.classList.add("input-primary"),y.disabled=!1,v.disabled=!1,b.disabled=!1,L.disabled=!1}));const S=document.querySelector(".js-profile-data__btns__cansel-btn");S?.addEventListener("click",(()=>{_.classList.remove("hide"),document.querySelector(".js-profile-data").classList.remove("profile-data-edit"),document.querySelector(".profile-data__control").classList.add("hide"),m.classList.remove("input-primary"),p.classList.remove("input-primary"),g.classList.remove("input-primary"),f.classList.remove("input-primary"),y.disabled=!0,v.disabled=!0,b.disabled=!0,L.disabled=!0,y.value=o.username,v.value=o.name,b.value=o.surname,L.value=o.about,i.textContent="",a.textContent="",c.textContent=""}));const k=document.querySelector(".js-profile-data__btns__save-btn");k?.addEventListener("click",(()=>{const e=y.value,r=h(e);if(!r.valid)return void(a.textContent=r.message);const s={username:e,name:v.value,surname:b.value,about_me:L.value};n.putUserInfo(s).then((e=>{"ok"===e.status?t.navigate("/profile/data"):"error"===e.status?c.textContent=`Некорректные данные: ${e.message}`:console.error("error saving data")})).catch((e=>{console.error(e)}))}))}))}()):this.navigate("/login")}},{path:"/profile/security",handler:()=>{this.state.getIsAuthorized()?(this.state.setCurrentPage("profileSecurity"),""===document.querySelector("#sidebar").innerHTML&&r(),y("profile-security"),""===document.querySelector("#header").innerHTML&&s(),f("Безопасность"),function(){const e=document.querySelector("#main"),t=new L;n.getUserInfo().then((r=>{const s=Handlebars.templates["ProfileSecurity.hbs"],o={email:r.email,avatar:r.avatar};e.innerHTML=s(o);const i=document.querySelector(".profile-security__change"),a=document.querySelector(".profile-security__save"),c=document.querySelector(".profile-security__data-password"),l=document.querySelector(".profile-security__data-password-repeat"),d=document.querySelector(".js-profile-security__data-mail-data"),u=document.querySelector(".js-profile-security__data-password-data"),h=document.querySelector(".js-profile-security__data-password-repeat-data"),g=document.querySelector(".js-mail-textarea"),f=document.querySelector(".js-password-textarea"),y=document.querySelector(".js-password-repeat-textarea"),v=document.querySelector(".profile-security-span"),b=document.querySelector(".profile-security__email-span"),L=document.querySelector(".profile-security__password-span"),_=document.querySelector(".profile-security__password-repeat-span"),S=document.querySelector(".profile-security__btn-change");S?.addEventListener("click",(()=>{i.classList.add("hide"),a.classList.remove("hide"),c.classList.remove("hide"),l.classList.remove("hide"),d.classList.add("input-primary"),u.classList.add("input-primary"),h.classList.add("input-primary"),g.disabled=!1,f.disabled=!1,y.disabled=!1}));const k=document.querySelector(".js-profile-security__btns__cansel-btn");k?.addEventListener("click",(()=>{i.classList.remove("hide"),a.classList.add("hide"),c.classList.add("hide"),l.classList.add("hide"),d.classList.remove("input-primary"),u.classList.remove("input-primary"),h.classList.remove("input-primary"),g.disabled=!0,f.disabled=!0,y.disabled=!0,g.value=o.email,f.value="",y.value="",v.textContent="",b.textContent="",L.textContent="",_.textContent=""}));const w=document.querySelector(".js-profile-security__btns__save-btn");w?.addEventListener("click",(()=>{const e=g.value,r=f.value,s=y.value;let o;if(""===r&&""===s){const t=m(e);if(!t.valid)return void(b.textContent=t.message);b.textContent="",o={email:e}}else{const t=m(e);t.valid?b.textContent="":b.textContent=t.message;const n=p(r);n.valid?L.textContent="":L.textContent=n.message;const i=p(s);if(i.valid?_.textContent="":_.textContent=i.message,_.textContent=r!==s?"Пароли не совпадают":"",!(t.valid&&n.valid&&i.valid&&r===s))return;o={email:e,password:r}}n.putUserInfo(o).then((e=>{"ok"===e.status?t.navigate("/profile/security"):v.textContent=`Некорректные данные: ${e.message}`})).catch((e=>{console.error(e)}))}))}))}()):this.navigate("/login")}},{path:"/login",handler:()=>{"login"!==this.state.getCurrentPage()&&(this.state.getIsAuthorized()?this.navigate("/"):(this.state.deleteAllPins(),this.state.setCurrentPage("login"),a(),function(){const e=new L,t=document.querySelector("#sidebar"),r=document.querySelector("#header"),s=document.querySelector("#main"),o=document.querySelector("#fullpage");t.innerHTML="",r.innerHTML="",s.innerHTML="";const i=Handlebars.templates["Authorization.hbs"];o.innerHTML=i({});const a=document.querySelector("#password"),c=document.querySelector("#username"),l=document.querySelector(".form__button"),d=document.querySelector(".cancel-button");document.querySelector(".already-registered a").addEventListener("click",(function(t){t.preventDefault(),o.innerHTML="",e.navigate("/signup")}));const u=document.querySelector(".username-error-message"),m=document.querySelector(".password-error-message"),g=document.querySelector(".wrong-data-error-message");l.addEventListener("click",(function(t){t.preventDefault();const s=document.getElementById("username").value,i=document.getElementById("password").value;c.style.borderColor="",a.style.borderColor="",c.style.color="",a.style.color="";const l=h(s),d=p(i);l.valid?u.textContent="":(c.style.borderColor="var(--error-50, #F4210B)",c.style.color="var(--error-50, #F4210B)",u.textContent=l.message),d.valid?m.textContent="":(a.style.borderColor="var(--error-50, #F4210B)",a.style.color="var(--error-50, #F4210B)",m.textContent=d.message),l.valid&&d.valid&&n.loginUser(s,i).then((t=>{t?n.checkLogin().then((()=>{r.innerHTML="",o.innerHTML="",e.navigate("/")})).catch((e=>{console.error(e)})):(c.style.borderColor="var(--error-50, #F4210B)",a.style.borderColor="var(--error-50, #F4210B)",g.textContent="Неверное имя пользователя или пароль")}))})),d.addEventListener("click",(function(t){t.preventDefault(),o.innerHTML="",e.navigate("/")}))}()))}},{path:"/signup",handler:()=>{"signup"!==this.state.getCurrentPage()&&(this.state.getIsAuthorized()?this.navigate("/"):(this.state.setCurrentPage("signup"),a(),function(){const e=new L,t=document.querySelector("#sidebar"),r=document.querySelector("#header"),s=document.querySelector("#main"),o=document.querySelector("#fullpage");t.innerHTML="",r.innerHTML="",s.innerHTML="";const i=Handlebars.templates["Registration.hbs"];o.innerHTML=i({});const a=document.querySelector("#password"),c=document.querySelector("#repeat-password"),l=document.querySelector("#email"),d=document.querySelector("#username"),u=document.querySelector(".form__button"),g=document.querySelector(".cancel-button");document.querySelector(".already-registered a").addEventListener("click",(function(t){t.preventDefault(),o.innerHTML="",e.navigate("/login")}));const f=document.querySelector(".username-error-message"),y=document.querySelector(".email-error-message"),v=document.querySelector(".password-error-message"),b=document.querySelector(".repeat-password-error-message"),_=document.querySelector(".wrong-data-error-message");u.addEventListener("click",(function(t){t.preventDefault();const s=document.getElementById("username").value,i=document.getElementById("email").value,u=document.getElementById("password").value,g=document.getElementById("repeat-password").value;d.style.borderColor="",l.style.borderColor="",a.style.borderColor="",c.style.borderColor="",d.style.color="",l.style.color="",a.style.color="",c.style.color="";const L=h(s),S=m(i),k=p(u),w=function(e,t){let n={valid:!0,message:""};return t?t!=e&&(n={valid:!1,message:"Пароли не совпадают"}):n={valid:!1,message:"Заполните это поле"},n}(u,g);L.valid?f.textContent="":(d.style.borderColor="var(--error-50, #F4210B)",d.style.color="var(--error-50, #F4210B)",f.textContent=L.message),S.valid?y.textContent="":(l.style.borderColor="var(--error-50, #F4210B)",l.style.color="var(--error-50, #F4210B)",y.textContent=S.message),k.valid?v.textContent="":(a.style.borderColor="var(--error-50, #F4210B)",a.style.color="var(--error-50, #F4210B)",v.textContent=k.message),w.valid?b.textContent="":(c.style.borderColor="var(--error-50, #F4210B)",c.style.color="var(--error-50, #F4210B)",b.textContent=w.message,a.style.borderColor="var(--error-50, #F4210B)",a.style.color="var(--error-50, #F4210B)",v.textContent=w.message),L.valid&&S.valid&&k.valid&&n.registerUser(s,i,u).then((t=>{t?n.checkLogin().then((()=>{r.innerHTML="",o.innerHTML="",e.navigate("/")})).catch((e=>{console.error(e)})):(d.style.borderColor="var(--error-50, #F4210B)",l.style.borderColor="var(--error-50, #F4210B)",a.style.borderColor="var(--error-50, #F4210B)",_.textContent="Пользователь уже зарегистрирован")}))})),g.addEventListener("click",(function(t){t.preventDefault(),o.innerHTML="",e.navigate("/")}))}()))}},{path:"/messenger",handler:()=>{"messenger"!==this.state.getCurrentPage()&&(this.state.getIsAuthorized()?(this.state.setCurrentPage("messenger"),""===document.querySelector("#sidebar").innerHTML&&r(),y("messenger"),""===document.querySelector("#header").innerHTML&&s(),f("Мессенджер"),function(){const e=document.querySelector("#main"),t=Handlebars.templates["Messenger.hbs"];e.innerHTML=t({}),l(document.querySelector(".messenger-non-content"),"У вас пока нет чатов","На главную","/")}()):this.navigate("/login"))}},{path:"/subscriptions",handler:()=>{"subscriptions"!==this.state.getCurrentPage()&&(this.state.getIsAuthorized()?(this.state.setCurrentPage("subscriptions"),""===document.querySelector("#sidebar").innerHTML&&r(),y("subscriptions"),""===document.querySelector("#header").innerHTML&&s(),f("Подписки"),function(){const e=document.querySelector("#main"),t=Handlebars.templates["Subscriptions.hbs"];e.innerHTML=t({}),n.getUserSubscriptions().then((e=>{if(!e)return void l(document.querySelector(".subscriptions-non-content"),"Вы пока ни на кого не подписались","На главную","/");!function(e,t){const n=Handlebars.templates["SubscriptionsUserItem.hbs"];t.forEach((t=>{const r={id:t.id,avatar:t.avatar,username:t.username};e?.insertAdjacentHTML("beforeend",n(r))}))}(document.querySelector(".subscriptions-gallery"),e),function(){const e=new L,t=document.querySelectorAll(".subscriptions__items");t?.forEach((t=>{t.addEventListener("click",(()=>{const n=t.getAttribute("class").split(" ")[1].split("-")[1];e.navigate(`/user/${n}`)}))}))}(),document.querySelector(".subscriptions__search").classList.remove("hide");const t=document.querySelector(".subscriptions__search__text-input");t?.addEventListener("input",(()=>{!function(e){const t=document.querySelectorAll(".subscriptions__items");t?.forEach((t=>{t.classList.remove("hide"),e&&!t.getAttribute("data-section").toLocaleLowerCase().includes(e.toLocaleLowerCase())&&t.classList.add("hide")}))}(t.value)}))})).catch((e=>{console.error(e)}))}()):this.navigate("/login"))}},{path:"/favourite",handler:()=>{"favourite"!==this.state.getCurrentPage()&&(this.state.getIsAuthorized()?(this.state.deleteAllPins(),this.state.setCurrentPage("favourite"),""===document.querySelector("#sidebar").innerHTML&&r(),y("favourite"),""===document.querySelector("#header").innerHTML&&s(),f("Понравившиеся пины"),function(){const e=document.querySelector("#main"),t=Handlebars.templates["Favourite.hbs"];e.innerHTML=t({}),n.getLikedPins().then((e=>{const t=document.getElementById("favourite-pins");if(e.pins)return o(t,e.pins),void i();l(document.querySelector(".favourite-non-content"),"У вас пока нет понравившихся пинов","Оценить пины","/")})).catch((e=>{console.error("Ошибка при рендеринге пинов:",e)}))}()):this.navigate("/login"))}},{path:"/create/pin",handler:()=>{"createPin"!==this.state.getCurrentPage()&&(this.state.getIsAuthorized?(this.state.deleteAllPins(),this.state.setCurrentPage("createPin"),""===document.querySelector("#sidebar").innerHTML&&r(),y(""),""===document.querySelector("#header").innerHTML&&s(),f("Создание пина"),function(){const e=new L,r=document.querySelector("#main"),s=(new t,Handlebars.templates["CreatePin.hbs"]);let o;r.innerHTML=s({});const i=document.querySelector(".js-pin-cancel__btn-change"),a=document.querySelector(".js-cancel__btn"),c=document.querySelector(".js-pin-create__btn-change"),l=document.getElementById("picture"),d=document.querySelector(".upload-image");function u(e){e.stopPropagation(),e.preventDefault()}function h(e){const t=new FileReader;t.onload=t=>{const n=t.target.result,r=e.type;o=new Blob([n],{type:r}),console.log(o)},t.readAsArrayBuffer(e)}a.addEventListener("click",(function(t){t.preventDefault(),e.navigate("/")})),i.addEventListener("click",(function(t){t.preventDefault(),e.navigate("/")})),c.addEventListener("click",(function(t){t.preventDefault();const r=document.getElementById("title").value,s=document.getElementById("description").value,i=new FormData;i.append("picture",o),i.append("title",r),i.append("description",s),i.append("public",!0),n.createPin(i).then((t=>{"ok"===t.status?e.navigate("/"):console.error("Error creating pin")})).catch((e=>{console.error(e)}))})),l.addEventListener("change",(e=>{h(e.target.files[0])})),d.addEventListener("dragenter",u),d.addEventListener("dragover",u),d.addEventListener("drop",(function(e){if(e.target===d){u(e);const t=e.dataTransfer.files;t.length>0&&h(t[0])}}))}()):this.navigate("/login"))}},{path:"/create/board",handler:()=>{"createBoard"!==this.state.getCurrentPage()&&(this.state.getIsAuthorized()?(this.state.deleteAllPins(),this.state.setCurrentPage("createBoard"),""===document.querySelector("#sidebar").innerHTML&&r(),y(""),""===document.querySelector("#header").innerHTML&&s(),f("Создание доски"),function(){const e=new L,r=document.querySelector("#main"),s=(new t,Handlebars.templates["CreateBoard.hbs"]);r.innerHTML=s({});const o=document.querySelector(".js-board-cancel__btn-change"),i=document.querySelector(".js-cancel__btn"),a=document.querySelector(".js-board-create__btn-change");i.addEventListener("click",(function(t){t.preventDefault(),e.navigate("/")})),o.addEventListener("click",(function(t){t.preventDefault(),e.navigate("/")})),a.addEventListener("click",(function(t){const r=document.getElementById("title").value,s=document.getElementById("description").value;console.log(r,s),n.createBoard(r,s).then((t=>{if(t&&"ok"===t.status&&t.body&&t.body.new_board_id){const n=t.body.new_board_id;e.navigate(`/create/board/${n}`)}else console.error(t)})).catch((e=>{console.error("Ошибка создания доски:",e)})),t.preventDefault()}))}()):this.navigate("/login"))}},{path:"/create/board/ID",handler:e=>{let{boardID:t}=e;this.state.getCurrentPage()!==`createВoard${t}`&&(this.state.getIsAuthorized()?(this.state.setCurrentPage(`createВoard${t}`),""===document.querySelector("#sidebar").innerHTML&&r(),y(""),""===document.querySelector("#header").innerHTML&&s(),g(t)):this.navigate("/create/board"))}},{path:"/pin/ID",handler:e=>{this.state.getCurrentPage()!==`pin${e}`&&(this.state.setCurrentPage(`pin${e}`),this.state.getIsAuthorized()?(""===document.querySelector("#sidebar").innerHTML&&r(),""===document.querySelector("#header").innerHTML&&s()):""===document.querySelector("#header").innerHTML&&a(),b(),function(e){const r=new L,s=document.querySelector("#main"),o=new t,i=Handlebars.templates["PinPage.hbs"];n.getPinInfo(e).then((t=>{console.log("Информация о пине:",t);const a={id:t.id,src:t.picture,username:t.author.username,title:t.title,description:t.description,likes:t.count_likes,avatar:t.author.avatar};s.innerHTML=i(a);const c=document.querySelector(".pin-like-icon"),l=document.querySelector(".pin-like-counter");n.getLike(e).then((e=>{e.is_set?c.src="/assets/icons/like_active.svg":c.src="/assets/icons/like.svg"})).catch((e=>{console.error(e)})),c?.addEventListener("click",(()=>{n.getLike(e).then((t=>{t.is_set?n.deleteLike(e).then((e=>{c.src="/assets/icons/like.svg",l.innerHTML=e.count_like})).catch((e=>{console.error(e)})):n.setLike(e).then((e=>{c.src="/assets/icons/like_active.svg",l.innerHTML=e.count_like})).catch((e=>{console.error(e)}))})).catch((e=>{console.error(e)}))}));const d=o.getUsername(),u=o.getIsAuthorized(),h=document.querySelector(".pin-title"),m=document.querySelector(".pin-description"),p=document.querySelector(".pin-control"),g=document.querySelector(".pin-control__cansel-btn"),f=document.querySelector(".pin-control__save-btn"),y=document.querySelector(".pin-edit-span-all"),v=document.querySelector(".js-pin-to-board__btn"),b=document.querySelector(".js-subscribe__btn"),L=document.querySelector(".js-delete__btn"),_=document.querySelector(".js-edit__btn");_.classList.add("hide"),L.classList.add("hide"),L?.addEventListener("click",(()=>{n.deletePin(e),r.navigate("/")})),_?.addEventListener("click",(()=>{_.classList.add("hide"),p.classList.remove("hide"),h.classList.add("input-primary"),m.classList.add("input-primary"),c.classList.add("hide"),l.classList.add("hide"),h.disabled=!1,m.disabled=!1,y.textContent=""})),g?.addEventListener("click",(()=>{_.classList.remove("hide"),p.classList.add("hide"),h.classList.remove("input-primary"),m.classList.remove("input-primary"),c.classList.remove("hide"),l.classList.remove("hide"),h.disabled=!0,m.disabled=!0,h.value=t.title,m.value=t.description,y.textContent=""})),f?.addEventListener("click",(()=>{n.putPinInfo(t.id,h.value,m.value).then((e=>{"ok"===e.status?(r.navigate(`/pin/${t.id}`),_.classList.remove("hide"),p.classList.add("hide"),h.classList.remove("input-primary"),m.classList.remove("input-primary"),c.classList.remove("hide"),l.classList.remove("hide")):y.textContent="Некорректные данные"})).catch((e=>{console.error(e)}))})),console.log(d,t.author.username),d===t.author.username&&(document.querySelector(".rectangle"),_.classList.remove("hide"),L.classList.remove("hide"),b.classList.add("hide")),u&&document.querySelector(".saved").appendChild(v)})).catch((e=>{console.error("Ошибка при получении информации о пине:",e),r.navigate("/page404")}))}(e))}},{path:"/board/ID",handler:e=>{this.state.getCurrentPage()!==`board${e}`&&(this.state.deleteAllPins(),this.state.setCurrentPage(`board${e}`),this.state.getIsAuthorized()?(""===document.querySelector("#sidebar").innerHTML&&r(),""===document.querySelector("#header").innerHTML&&s()):""===document.querySelector("#header").innerHTML&&a(),b(),async function(e){const r=new L,s=document.querySelector("#main"),a=new t,c=Handlebars.templates["BoardPage.hbs"],l=[190,2,1];try{const t=await n.getBoardInfo(e);console.log("Информация о доске:",t);const d={title:t.title,description:t.description};s.innerHTML=c(d);const u=a.getUsername(),h=document.querySelector(".board-title"),m=document.querySelector(".pin-description"),p=document.querySelector(".pin-control"),g=document.querySelector(".pin-control__cansel-btn"),f=document.querySelector(".pin-control__save-btn"),y=document.querySelector(".pin-edit-span-all"),v=document.querySelector(".js-delete__btn"),b=document.querySelector(".js-edit__btn");b?.addEventListener("click",(()=>{b.classList.add("hide"),p.classList.remove("hide"),h.classList.add("input-primary"),m.classList.add("input-primary"),h.disabled=!1,m.disabled=!1,y.textContent=""})),g?.addEventListener("click",(()=>{b.classList.remove("hide"),p.classList.add("hide"),h.classList.remove("input-primary"),m.classList.remove("input-primary"),h.disabled=!0,m.disabled=!0,h.value=t.title,m.value=t.description,y.textContent=""})),f?.addEventListener("click",(()=>{n.putBoardInfo(t.board_id,h.value,m.value,l).then((e=>{"ok"===e.status?r.navigate(`/board/${t.board_id}`):y.textContent="Некорректные данные"})).catch((e=>{console.error(e)}))})),v.addEventListener("click",(async function(t){t.preventDefault(),await n.deleteBoard(e),r.navigate("/profile")})),console.log(u);const L=document.querySelector(".bar");L.appendChild(v),L.appendChild(b),await async function(){try{const t=await n.getBoardPins(e);o(document.getElementById("board-pins"),t.pins),i()}catch(e){console.error("Ошибка при рендеринге пинов:",e)}}()}catch(e){console.error("Ошибка при получении информации о доске:",e),r.navigate("/page404")}}(e))}},{path:"/user/ID",handler:e=>{this.state.getCurrentPage()!==`user${e}`&&(this.state.getUserID()!=e?(this.state.deleteAllPins(),this.state.setCurrentPage(`user${e}`),this.state.getIsAuthorized()?(""===document.querySelector("#sidebar").innerHTML&&r(),""===document.querySelector("#header").innerHTML&&s()):""===document.querySelector("#header").innerHTML&&a(),function(e){const t=document.querySelector("#main");n.getSomeUserInfo(e).then((r=>{const s=Handlebars.templates["UserPage.hbs"],o={id:r.id,username:r.username,avatar:r.avatar,name:r.name,surname:r.surname,about:r.about,subscribers:r.subscribers,isSubscribed:r.is_subscribed};t.innerHTML=s(o);const i=document.querySelector(".user__subscribe-btn"),a=document.querySelector(".user__unsubscribe-btn"),l=document.querySelector(".user__subscriptions-text");r.is_subscribed?a.classList.remove("hide"):i.classList.remove("hide"),i?.addEventListener("click",(()=>{i.classList.add("hide"),a.classList.remove("hide"),l.innerHTML=+l.innerHTML+1,n.subscribeToUser(e).then(((e,t)=>{e&&(console.log(e,t),i.classList.remove("hide"),a.classList.add("hide"),l.innerHTML=+l.innerHTML-1)})).catch((e=>{console.error(e),i.classList.remove("hide"),a.classList.add("hide"),l.innerHTML=+l.innerHTML-1}))})),a?.addEventListener("click",(()=>{i.classList.remove("hide"),a.classList.add("hide"),l.innerHTML=+l.innerHTML-1,n.unsubscribeFromUser(e).then(((e,t)=>{e&&(console.log(e,t),i.classList.add("hide"),a.classList.remove("hide"),l.innerHTML=+l.innerHTML+1)})).catch((e=>{console.error(e),i.classList.add("hide"),a.classList.remove("hide"),l.innerHTML=+l.innerHTML+1}))}));const u=document.querySelector(".user__pins-btn");u?.addEventListener("click",(()=>{const t=document.querySelector(".user__btn-active");t!==u&&(t.classList.remove("user__btn-active"),u.classList.add("user__btn-active"),v(e))}));const h=document.querySelector(".user__boards-btn");h?.addEventListener("click",(()=>{const e=document.querySelector(".user__btn-active");var t;e!==h&&(e.classList.remove("user__btn-active"),h.classList.add("user__btn-active"),t=r.username,n.getUserBoards(t).then((e=>{const t=document.querySelector(".user-non-content"),n=document.querySelector(".user-pins-gallery"),r=document.querySelector(".user-boards-gallery");n.innerHTML="",t.innerHTML="",e.length?(c(r,e),d()):t.innerHTML="У этого пользователя нет досок"})).catch((e=>{console.error("Ошибка при рендеринге досок:",e)})))})),v(e)})).catch((e=>{console.error(e)}))}(e)):this.navigate("/profile"))}}],this.#l=null,this.#d=()=>{this.state.getIsAuthorized()?(""===document.querySelector("#sidebar").innerHTML&&r(),""===document.querySelector("#header").innerHTML&&s(),y("")):""===document.querySelector("#header").innerHTML&&a(),function(){const e=new L,t=document.querySelector("#main");t.innerHTML="";const n=Handlebars.templates["Page404.hbs"];t.innerHTML=n({});const r=document.querySelector(".page404-home-btn");r?.addEventListener("click",(n=>{n.preventDefault(),t.innerHTML="",e.navigate("/")}))}()},this.#u=this.handlePopstate.bind(this),window.addEventListener("popstate",this.#u)}navigate(e){window.history.pushState(null,null,e),this.handlePopstate()}handlePopstate(){const e=window.location.pathname,t=this.#c.find((t=>t.path===e));switch(!0){case void 0!==t:this.#l=t,t.handler();break;case/^\/pin\/\d+$/.test(e):this.#l=this.#c.find((e=>"/pin/ID"===e.path)),this.#l.handler(e.split("/")[2]);break;case/^\/board\/\d+$/.test(e):this.#l=this.#c.find((e=>"/board/ID"===e.path)),this.#l.handler(e.split("/")[2]);break;case/^\/create\/board\/\d+$/.test(e):const n=e.split("/")[3];this.#l=this.#c.find((e=>"/create/board/ID"===e.path)),this.#l.handler({boardID:n});break;case/^\/user\/\d+$/.test(e):this.#l=this.#c.find((e=>"/user/ID"===e.path)),this.#l.handler(e.split("/")[2]);break;default:this.#l=null,this.#d()}}}const _=new L;n.getCsrfToken().then((()=>{n.checkLogin().then((()=>{_.handlePopstate()}))}))})();